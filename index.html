<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发发信息管理系统</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 登录页面 -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>发发信息管理系统</h1>
                <p>中中中中大学发发信息管理学院</p>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">工号/用户名</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" name="password" required>
                </div>
                
                <button type="submit" class="btn btn-primary">登录</button>
            </form>
            
            <div id="login-error" class="alert alert-error hidden">
                用户名或密码错误，请重试。
            </div>
            
            <div class="demo-accounts">
                <h4>测试账号</h4>
                <p>管理员：admin / admin123</p>
                <p>教师：202401 / 123456</p>
            </div>
        </div>
    </div>

    <!-- 主系统界面 -->
    <div id="main-system" class="system-container">
        <!-- 系统头部 -->
        <header class="system-header">
            <div class="system-title">发发信息管理系统</div>
            <div class="user-info">
                <span id="current-user">用户名</span>
                <span id="user-role">教师</span>
                <button class="btn btn-secondary" onclick="logout()">退出登录</button>
            </div>
        </header>

        <!-- 主要内容区 -->
        <main class="main-content">
            <!-- 教师端首页 -->
            <div id="teacher-dashboard">
                <h2 style="margin-bottom: 20px;">我的任务</h2>
                
                <!-- 待办任务卡片 -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-header">
                        <span class="card-title">待办任务</span>
                        <span class="badge" id="pending-count">0</span>
                    </div>
                    <ul class="task-list" id="pending-tasks">
                        <!-- 任务将动态加载 -->
                    </ul>
                </div>

                <!-- 已完成任务卡片 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">已完成任务</span>
                        <span class="badge completed" id="completed-count">0</span>
                    </div>
                    <ul class="task-list" id="completed-tasks">
                        <!-- 已完成任务将动态加载 -->
                    </ul>
                </div>
            </div>

            <!-- 管理员端首页 -->
            <div id="admin-dashboard" class="hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2>业务管理</h2>
                    <button class="btn btn-primary" onclick="showUserManagement()">用户管理</button>
                </div>
                
                <div class="dashboard-grid">
                    <!-- 基层教学组织活动业务卡片 -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">基层教学组织活动开展计划</span>
                            <span class="badge">进行中</span>
                        </div>
                        <p style="color: var(--dark-gray); margin: 10px 0;">目标用户：韩帅、郑宸昆、王雅实、张红岩</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="publishBusiness('teaching-activity')">发布任务</button>
                            <button class="btn btn-secondary" onclick="viewSubmissions('teaching-activity')">查看提交</button>
                            <button class="btn btn-success" onclick="exportData('teaching-activity')">导出数据</button>
                        </div>
                    </div>

                    <!-- 教材录入业务卡片 -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">教材信息录入</span>
                            <span class="badge pending">待发布</span>
                        </div>
                        <p style="color: var(--dark-gray); margin: 10px 0;">目标用户：所有任课教师</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="publishBusiness('textbook-entry')">发布任务</button>
                            <button class="btn btn-secondary" onclick="viewSubmissions('textbook-entry')">查看提交</button>
                            <button class="btn btn-success" onclick="exportData('textbook-entry')">导出数据</button>
                        </div>
                    </div>

                    <!-- 命题费统计业务卡片 -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">命题费统计填报</span>
                            <span class="badge">进行中</span>
                        </div>
                        <p style="color: var(--dark-gray); margin: 10px 0;">目标用户：课程负责人</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-secondary" onclick="downloadExamFeeTemplate()">下载数据模板</button>
                            <button class="btn btn-primary" onclick="showExamFeeUpload()">上传课程数据</button>
                            <button class="btn btn-primary" onclick="publishBusiness('exam-fee')">发布任务</button>
                            <button class="btn btn-secondary" onclick="viewSubmissions('exam-fee')">查看提交</button>
                            <button class="btn btn-success" onclick="exportData('exam-fee')">导出数据</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 业务表单页面 -->
            <div id="business-form-page" class="hidden">
                <div class="business-form">
                    <div class="form-header">
                        <h2 id="business-title">基层教学组织活动开展计划</h2>
                        <button class="btn btn-secondary" onclick="backToDashboard()">返回首页</button>
                    </div>
                    
                    <div id="business-form-content">
                        <!-- 表单内容将在这里动态加载 -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 用户管理模态框 -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>用户管理</h2>
                <span class="close" onclick="closeModal('user-modal')">&times;</span>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="showAddUser()">添加用户</button>
                <button class="btn btn-primary" onclick="showBatchImportUsers()">批量导入用户</button>
                <button class="btn btn-secondary" onclick="downloadUserTemplate()">下载导入模板</button>
                <button class="btn btn-success" onclick="exportUsers()">导出用户列表</button>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>工号</th>
                        <th>姓名</th>
                        <th>角色</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="user-table-body">
                    <tr>
                        <td>202401</td>
                        <td>韩帅</td>
                        <td>教师</td>
                        <td>正常</td>
                        <td>
                            <button class="btn btn-secondary">编辑</button>
                            <button class="btn btn-danger">重置密码</button>
                        </td>
                    </tr>
                    <tr>
                        <td>202402</td>
                        <td>郑宸昆</td>
                        <td>教师</td>
                        <td>正常</td>
                        <td>
                            <button class="btn btn-secondary">编辑</button>
                            <button class="btn btn-danger">重置密码</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 批量导入用户模态框 -->
    <div id="batch-import-users-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>批量导入用户</h2>
                <span class="close" onclick="closeModal('batch-import-users-modal')">&times;</span>
            </div>
            
            <div class="alert alert-warning">
                <strong>导入格式要求：</strong>工号 | 姓名 | 初始密码 | 角色(teacher/admin)
            </div>
            
            <div class="upload-area" onclick="document.getElementById('users-file-upload').click()">
                <div>
                    <strong>点击上传Excel文件</strong><br>
                    或拖拽文件到此区域
                </div>
                <input type="file" id="users-file-upload" class="file-input" accept=".xlsx,.xls" onchange="handleUsersFileUpload(event)">
            </div>
            
            <div id="users-upload-preview" class="hidden" style="margin-top: 20px;">
                <h4>数据预览</h4>
                <div style="max-height: 300px; overflow-y: auto;">
                    <table class="data-table" id="users-preview-table">
                        <thead id="users-preview-header"></thead>
                        <tbody id="users-preview-body"></tbody>
                    </table>
                </div>
                <div style="text-align: right; margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="cancelUsersUpload()">取消</button>
                    <button class="btn btn-primary" onclick="confirmUsersUpload()">确认导入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 命题费数据上传模态框 -->
    <div id="exam-fee-upload-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>上传命题费课程数据</h2>
                <span class="close" onclick="closeModal('exam-fee-upload-modal')">&times;</span>
            </div>
            
            <div class="alert alert-warning">
                <strong>表格格式要求：</strong>课序号 | 课程名 | 课程负责人 | 上课教师 | 工号
            </div>
            
            <div class="upload-area" onclick="document.getElementById('exam-fee-file-upload').click()">
                <div>
                    <strong>点击上传Excel文件</strong><br>
                    或拖拽文件到此区域
                </div>
                <input type="file" id="exam-fee-file-upload" class="file-input" accept=".xlsx,.xls" onchange="handleExamFeeFileUpload(event)">
            </div>
            
            <div id="exam-fee-upload-preview" class="hidden" style="margin-top: 20px;">
                <h4>数据预览</h4>
                <div style="max-height: 300px; overflow-y: auto;">
                    <table class="data-table" id="exam-fee-preview-table">
                        <thead id="exam-fee-preview-header"></thead>
                        <tbody id="exam-fee-preview-body"></tbody>
                    </table>
                </div>
                <div style="text-align: right; margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="cancelExamFeeUpload()">取消</button>
                    <button class="btn btn-primary" onclick="confirmExamFeeUpload()">确认导入</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script></script>
</body>
</html>
